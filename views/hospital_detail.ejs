<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= hospital.name %> - Hospital Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: "Segoe UI", Arial, sans-serif;
      background-color: #f8f9fa;
      color: #212529;
    }

    /* Header/Nav */
    .navbar {
      background-color: #003366;
    }
    .navbar-brand, .nav-link {
      color: #fff !important;
      font-weight: 500;
    }

    /* Section Titles */
    h2, h4, h5 {
      color: #003366;
      font-weight: 600;
    }

    /* Card Blocks */
    .info-card {
      background: #fff;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    /* Doctor Slot Buttons */
    .btn-sm {
      font-size: 0.85rem;
      font-weight: 500;
    }

    /* Room & Ambulance List */
    .list-group-item {
      font-size: 0.95rem;
    }

    /* Footer */
    footer {
      background-color: #003366;
      color: #fff;
      text-align: center;
      padding: 1rem;
      margin-top: 3rem;
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="/">Ayuvaani</a>
    </div>
  </nav>

  <!-- Main Container -->
  <div class="container mt-4">

    <!-- Hospital Details -->
    <div class="info-card shadow-sm">
      <h2><i class="fa-solid fa-hospital"></i> <%= hospital.name %></h2>
      <p><i class="fa-solid fa-envelope"></i> <strong>Email:</strong> <%= hospital.email %></p>
      <p><i class="fa-solid fa-phone"></i> <strong>Phone:</strong> <%= hospital.phone %></p>
      <p><i class="fa-solid fa-location-dot"></i> <strong>Address:</strong> <%= hospital.address %></p>
    </div>

    <!-- Doctors Section -->
    <div class="info-card shadow-sm">
      <h4><i class="fa-solid fa-user-doctor"></i> Doctors</h4>
      <% 
        const categories = {};
        hospital.doctors.forEach(doc => {
          if (!categories[doc.category]) categories[doc.category] = [];
          categories[doc.category].push(doc);
        });
      %>
      <% Object.keys(categories).forEach(cat => { %>
        <div class="mt-4">
          <h5><%= cat %></h5>
          <ul class="list-group">
            <% categories[cat].forEach(doctor => { %>
              <li class="list-group-item">
                <h6><%= doctor.name %></h6>
                <p><i class="fa-solid fa-envelope"></i> <%= doctor.email %></p>

                <!-- OPD Slots -->
                <p><strong>OPD Slots:</strong></p>
                <% if (doctor.slots && doctor.slots.length > 0) { %>
                  <ul class="list-inline">
                    <% doctor.slots.forEach(slot => { 
                      const bookedCount = doctor.bookedSlots?.get(slot) || 0;
                      const remaining = (doctor.slotCapacity || 15) - bookedCount;
                      const isFull = remaining <= 0;
                    %>
                      <li class="list-inline-item mb-2">
                        <% if(!isFull) { %>
                          <a href="/opd/new?hospitalId=<%= hospital._id %>&doctorId=<%= doctor._id %>&slot=<%= slot %>" 
                             class="btn btn-sm btn-primary">
                            <i class="fas fa-calendar-check"></i> <%= slot %> (<%= remaining %> left)
                          </a>
                        <% } else { %>
                          <button class="btn btn-sm btn-secondary" disabled>
                            <i class="fas fa-times-circle"></i> Full <%= slot %>
                          </button>
                        <% } %>
                      </li>
                    <% }) %>
                  </ul>
                <% } else { %>
                  <span class="text-muted">No OPD slots available</span>
                <% } %>

                <!-- Online Slots -->
                <p><strong>Online Slots:</strong></p>
                <% if (doctor.onlineSlots && doctor.onlineSlots.length > 0) { %>
                  <ul class="list-inline">
                    <% doctor.onlineSlots.forEach(slot => { 
                      const bookedCount = doctor.bookedOnlineSlots?.get(slot) || 0;
                      const remaining = (doctor.onlineSlotCapacity || 15) - bookedCount;
                      const isFull = remaining <= 0;
                    %>
                      <li class="list-inline-item mb-2">
                        <% if(!isFull) { %>
                          <a href="/bookings/new?doctorId=<%= doctor._id %>&slot=<%= slot %>" 
                             class="btn btn-sm btn-success">
                            <i class="fas fa-video"></i> <%= slot %> (<%= remaining %> left)
                          </a>
                        <% } else { %>
                          <button class="btn btn-sm btn-secondary" disabled>
                            <i class="fas fa-times-circle"></i> Full <%= slot %>
                          </button>
                        <% } %>
                      </li>
                    <% }) %>
                  </ul>
                <% } else { %>
                  <span class="text-muted">No Online slots available</span>
                <% } %>
              </li>
            <% }) %>
          </ul>
        </div>
      <% }) %>
    </div>

    <!-- Room Availability -->
    <div class="info-card shadow-sm">
      <h4><i class="fa-solid fa-bed"></i> Room Availability</h4>
      <ul class="list-group">
        <% hospital.rooms.forEach(room => { %>
          <li class="list-group-item">
            <%= room.type %>: <%= room.available %> / <%= room.total %> available
          </li>
        <% }) %>
      </ul>
    </div>

    <!-- Ambulances -->
    <div class="info-card shadow-sm">
      <h4><i class="fa-solid fa-truck-medical"></i> Ambulances</h4>
      <p>Total Available: <strong><%= hospital.ambulances %></strong></p>
    </div>

  </div>

  <!-- Footer -->
  <footer>
    <p>Â© 2025 Ayuvaani | Powered by Government of India | UX4G Compliant</p>
  </footer>

</body>
</html>
